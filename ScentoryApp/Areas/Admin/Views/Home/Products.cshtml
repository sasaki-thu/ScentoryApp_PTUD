
@{
    ViewData["Title"] = "Quản lý sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="row align-items-center mb-2">
                <div class="col">
                    <h2 class="h2 page-title">Quản lý sản phẩm</h2>
                </div>
                <div class="col-auto">
                    <form class="form-inline">
                        <div class="form-group">
                            <!-- Thêm Mới Sản phẩm, mở bảng để điền -->
                            <button type="button" class="btn btn-primary" id="addProduct">
                                <i class="fe fe-plus fe-16"></i> Thêm sản phẩm mới
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bảng dữ liệu sản phẩm -->
            <div class="card shadow">
                <div class="card-body">
                    <table class="table table-hover table-borderless border-v">
                        <thead>
                            <tr>
                                <th>ID Sản Phẩm</th>
                                <th>Tên</th>
                                <th>Giá niêm yết</th>
                                <th>Số lượng tồn kho</th>
                                <th>Trạng thái</th>
                                <th>Thời gian tạo</th>
                                <th>Danh mục</th>
                                <th>Tác vụ</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                            <!-- Dữ liệu mẫu, có SQL rồi thay sau -->
                            <tr id="row-sp001">
                                <td>SP001</td>
                                <td>Nước hoa Whisper (Thầm) - 50ml</td>
                                <td>699.000 đ</td>
                                <td>50</td>
                                <td><span class="badge badge-success">Đang bán</span></td>
                                <td>2025-10-10</td>
                                <td>Nước hoa Reminiscence</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="sp001">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="sp001">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="sp001">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr id="row-sp002">
                                <td>SP002</td>
                                <td>Tinh dầu Summer (Hạ) - 50ml</td>
                                <td>399.000 đ</td>
                                <td>120</td>
                                <td><span class="badge badge-success">Đang bán</span></td>
                                <td>2025-10-10</td>
                                <td>Tinh dầu Seviora</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="sp002">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="sp002">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="sp002">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr id="row-sp003">
                                <td>SP003</td>
                                <td>Nước hoa Aurora (Uyển) - 10ml</td>
                                <td>179.000 đ</td>
                                <td>0</td>
                                <td><span class="badge badge-danger">Ngừng bán</span></td>
                                <td>2025-10-10</td>
                                <td>Nước hoa Reminiscence</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="sp003">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="sp003">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="sp003">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div> <!-- .row -->
</div> <!-- .container-fluid -->
<!-- =================================================== -->
<!-- Modal (Bảng chi tiết) cho Add / Edit / Details -->
<!-- =================================================== -->
<div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productModalLabel">Thông tin sản phẩm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <fieldset id="productFieldset">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="sp_id">ID Sản Phẩm</label>
                                <input type="text" class="form-control" id="sp_id" placeholder="SP00x">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="sp_ten">Tên</label>
                                <input type="text" class="form-control" id="sp_ten" placeholder="Nước hoa...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sp_mota">Mô tả sản phẩm</label>
                            <textarea class="form-control" id="sp_mota" rows="3" placeholder="Mô tả chi tiết..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="sp_gia">Giá niêm yết</label>
                                <input type="number" class="form-control" id="sp_gia" placeholder="3500000">
                            </div>
                            <div class="form-group col-md-4">
                                <label for="sp_tonkho">Số lượng tồn kho</label>
                                <input type="number" class="form-control" id="sp_tonkho" placeholder="50">
                            </div>
                            <div class="form-group col-md-4">
                                <label for="sp_danhmuc">Danh mục</label>
                                <select id="sp_danhmuc" class="form-control">
                                    <option selected>Nước hoa Reminiscence</option>
                                    <option>Tinh dầu Seviora</option>
                                    <option>Tinh dầu</option>
                                    <option>Nước hoa</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="sp_trangthai" checked>
                                <label class="custom-control-label" for="sp_trangthai">Trạng thái (Đang bán)</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sp_thoigiantao">Thời gian tạo</label>
                            <input type="text" class="form-control" id="sp_thoigiantao" readonly>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveProductBtn">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- =================================================== -->
<!-- Modal (Xác nhận Xóa) -->
<!-- =================================================== -->
<div class="modal fade" id="confirmRemoveModal" tabindex="-1" role="dialog" aria-labelledby="confirmRemoveLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmRemoveLabel">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa sản phẩm <strong id="productNameRemove"></strong> không? Hành động này không thể hoàn tác.
                <input type="hidden" id="removeProductId" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmRemoveBtn">Xóa</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {

            // --- HÀM MOCKUP: Lấy dữ liệu (giả) của 1 sản phẩm ---
            function getMockProductData(id) {
                // sau này dùng AJAX gọi về Controller để lấy data
                const mockData = {
                    'sp001': {
                        id: 'SP001',
                        ten: 'Nước hoa Whisper (Thầm) - 50ml',
                        gia: 699000,
                        tonkho: 50,
                        trangthai: true,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Nước hoa Reminiscence',
                        mota: 'Aurora – Uyển mềm mại như cực quang trên bầu trời đêm, kết hợp bergamot tươi mát, trà xanh thanh khiết, hoa nhài và mẫu đơn dịu dàng. Sự tinh tế, uyển chuyển và quyến rũ dành cho những ai yêu thích sự thanh lịch và lãng mạn.'

                    },
                    'sp002': {
                        id: 'SP002',
                        ten: 'Tinh dầu Summer (Hạ) - 50ml',
                        gia: 399000,
                        tonkho: 120,
                        trangthai: true,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Tinh dầu Seviora',
                        mota: 'Tinh dầu Summer – Hạ mang hơi thở nắng vàng rực rỡ, kết hợp hương biển và cam chanh mát lạnh, tạo bầu không khí sảng khoái.'
                    },
                    'sp003': {
                        id: 'SP003',
                        ten: 'Nước hoa Aurora (Uyển) - 10ml',
                        gia: 179000,
                        tonkho: 0,
                        trangthai: false,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Tinh dầu Seviora',
                        mota: 'Aurora – Uyển mềm mại như cực quang trên bầu trời đêm, kết hợp bergamot tươi mát, trà xanh thanh khiết, hoa nhài và mẫu đơn dịu dàng. Sự tinh tế, uyển chuyển và quyến rũ dành cho những ai yêu thích sự thanh lịch và lãng mạn.'
                    }
                };
                return mockData[id];
            }

            // --- HÀM MOCKUP: Đổ dữ liệu vào form ---
            function fillForm(data) {
                $('#sp_id').val(data.id);
                $('#sp_ten').val(data.ten);
                $('#sp_mota').val(data.mota);
                $('#sp_gia').val(data.gia);
                $('#sp_tonkho').val(data.tonkho);
                $('#sp_danhmuc').val(data.danhmuc);
                $('#sp_trangthai').prop('checked', data.trangthai);
                $('#sp_thoigiantao').val(data.thoigiantao);
            }

            // --- HÀM: Xóa sạch form ---
            function clearForm() {
                $('#productForm')[0].reset();
                $('#sp_id').val('');
                $('#sp_trangthai').prop('checked', true);
            }

            // --- HÀM: Khóa hoặc Mở khóa form ---
            function toggleFormLock(disabled) {
                $('#productFieldset').prop('disabled', disabled);
                // Ẩn/hiện nút Lưu
                if (disabled) {
                    $('#saveProductBtn').hide();
                } else {
                    $('#saveProductBtn').show();
                }
            }

            // === XỬ LÝ SỰ KIỆN ===

            // 1. Bấm nút "Thêm sản phẩm mới"
            $('#addProduct').on('click', function () {
                clearForm();
                toggleFormLock(false); // Mở khóa form
                $('#productModalLabel').text('Thêm sản phẩm mới');
                $('#productModal').modal('show');
            });

            // 2. Bấm nút "Details"
            $('#productTableBody').on('click', '.btn-details', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                fillForm(data);
                toggleFormLock(true); // Khóa form
                $('#productModalLabel').text('Chi tiết sản phẩm');
                $('#productModal').modal('show');
            });

            // 3. Bấm nút "Edit"
            $('#productTableBody').on('click', '.btn-edit', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                fillForm(data);
                toggleFormLock(false); // Mở khóa form
                $('#productModalLabel').text('Chỉnh sửa sản phẩm');
                $('#productModal').modal('show');
            });

            // 4. Bấm nút "Remove"
            $('#productTableBody').on('click', '.btn-remove', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                // Đặt tên vào modal xác nhận
                $('#productNameRemove').text(data.ten + ` (ID: ${data.id})`);
                // Lưu id vào modal để dùng lúc bấm nút Xóa
                $('#removeProductId').val(id);

                $('#confirmRemoveModal').modal('show');
            });

            // 5. Bấm nút "Xóa" trên Modal xác nhận
            $('#confirmRemoveBtn').on('click', function () {
                const id = $('#removeProductId').val();

                // (Trong dự án thật, bạn sẽ dùng AJAX gọi về Controller để xóa)

                // Xóa (giả) hàng khỏi bảng
                $('#row-' + id).remove();

                // Đóng modal
                $('#confirmRemoveModal').modal('hide');
            });

        });
    </script>
}

