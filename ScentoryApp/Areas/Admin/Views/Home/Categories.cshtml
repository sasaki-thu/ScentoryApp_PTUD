@{
    ViewData["Title"] = "Quản lý danh mục sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="row align-items-center mb-2">
                <div class="col">
                    <h2 class="h2 page-title">Quản lý danh mục sản phẩm</h2>
                </div>
                <div class="col-auto">
                    <form class="form-inline">
                        <div class="form-group">
                            <!-- Thêm Mới Sản phẩm, mở bảng để điền -->
                            <button type="button" class="btn btn-primary" id="addProduct">
                                <i class="fe fe-plus fe-16"></i> Thêm danh mục mới
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bảng dữ liệu sản phẩm -->
            <div class="card shadow">
                <div class="card-body">
                    <table class="table table-hover table-borderless border-v">
                        <thead>
                            <tr>
                                <th>ID Danh Mục</th>
                                <th>Tên Danh Mục</th>
                                <th>Mô tả</th>
                                @* <th>Số lượng tồn kho</th> *@
                                <th>Trạng thái</th>
                                <th>Thời gian tạo</th>
                                <th>Thời gian cập nhật</th>
                                @* <th>Tác vụ</th> *@
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                            <!-- Dữ liệu mẫu, có SQL rồi thay sau -->
                            <tr id="row-dm001">
                                <td>DM001</td>
                                <td>Nước hoa Reminiscence</td>
                                <td>Các sản phẩm nước hoa của Scentory</td>
                                @* <td>50</td> *@
                                <td><span class="badge badge-success">Đang hiển thị</span></td>
                                <td>2025-10-10</td>
                                <td>2025-14-10</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="dm001">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="dm001">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="dm001">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr id="row-dm002">
                                <td>DM002</td>
                                <td>Tinh dầu Seviora</td>
                                <td>Các sản phẩm tinh dầu của Scentory</td>
                                @* <td>120</td> *@
                                <td><span class="badge badge-success">Đang hiển thị</span></td>
                                <td>2025-10-08</td>
                                <td>2025-10-09</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="dm002">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="dm002">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="dm002">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr id="row-dm003">
                                <td>DM003</td>
                                <td>Đang bán chạy</td>
                                <td>Tổng hợp các sản phẩm đang bán chạy</td>
                                @* <td>0</td> *@
                                <td><span class="badge badge-danger">Đang ẩn</span></td>
                                <td>2025-10-07</td>
                                <td>2025-10-11</td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm dropdown-toggle more-vertical" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-muted sr-only">Action</span>
                                        </button>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item btn-details" href="#" data-id="dm003">Details</a>
                                            <a class="dropdown-item btn-edit" href="#" data-id="dm003">Edit</a>
                                            <a class="dropdown-item btn-remove" href="#" data-id="dm003">Remove</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div> <!-- .row -->
</div> <!-- .container-fluid -->
<!-- =================================================== -->
<!-- Modal (Bảng chi tiết) cho Add / Edit / Details -->
<!-- =================================================== -->
<div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productModalLabel">Thông tin danh mục</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <fieldset id="productFieldset">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="dm_id">ID Danh Mục</label>
                                <input type="text" class="form-control" id="dm_id" placeholder="DM00x">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="dm_ten">Tên Danh Mục</label>
                                <input type="text" class="form-control" id="dm_ten" placeholder="Nước hoa...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dm_mota">Mô tả</label>
                            <textarea class="form-control" id="dm_mota" rows="3" placeholder="Mô tả chi tiết..."></textarea>
                        </div>
                        <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="dm_thoigiantao">Thời gian tạo</label>
                            <input type="text" class="form-control" id="dm_thoigiantao" readonly>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="dm_thoigiancapnhat">Thời gian cập nhật</label>
                            <input type="text" class="form-control" id="dm_thoigiancapnhat" readonly>
                        </div>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="dm_trangthai" checked>
                                <label class="custom-control-label" for="dm_trangthai">Trạng thái (Đang hiển thị)</label>
                            </div>
                        </div>

                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveProductBtn">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- =================================================== -->
<!-- Modal (Xác nhận Xóa) -->
<!-- =================================================== -->
<div class="modal fade" id="confirmRemoveModal" tabindex="-1" role="dialog" aria-labelledby="confirmRemoveLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmRemoveLabel">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa danh mục <strong id="cateRemove"></strong> không? Hành động này không thể hoàn tác.
                <input type="hidden" id="removeCateId" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmRemoveBtn">Xóa</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {

            // --- HÀM MOCKUP: Lấy dữ liệu (giả) của 1 sản phẩm ---
            function getMockProductData(id) {
                // sau này dùng AJAX gọi về Controller để lấy data
                const mockData = {
                    'sp001': {
                        id: 'SP001',
                        ten: 'Nước hoa Whisper (Thầm) - 50ml',
                        gia: 699000,
                        tonkho: 50,
                        trangthai: true,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Nước hoa Reminiscence',
                        mota: 'Aurora – Uyển mềm mại như cực quang trên bầu trời đêm, kết hợp bergamot tươi mát, trà xanh thanh khiết, hoa nhài và mẫu đơn dịu dàng. Sự tinh tế, uyển chuyển và quyến rũ dành cho những ai yêu thích sự thanh lịch và lãng mạn.'

                    },
                    'sp002': {
                        id: 'SP002',
                        ten: 'Tinh dầu Summer (Hạ) - 50ml',
                        gia: 399000,
                        tonkho: 120,
                        trangthai: true,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Tinh dầu Seviora',
                        mota: 'Tinh dầu Summer – Hạ mang hơi thở nắng vàng rực rỡ, kết hợp hương biển và cam chanh mát lạnh, tạo bầu không khí sảng khoái.'
                    },
                    'sp003': {
                        id: 'SP003',
                        ten: 'Nước hoa Aurora (Uyển) - 10ml',
                        gia: 179000,
                        tonkho: 0,
                        trangthai: false,
                        thoigiantao: '2025-10-10',
                        danhmuc: 'Tinh dầu Seviora',
                        mota: 'Aurora – Uyển mềm mại như cực quang trên bầu trời đêm, kết hợp bergamot tươi mát, trà xanh thanh khiết, hoa nhài và mẫu đơn dịu dàng. Sự tinh tế, uyển chuyển và quyến rũ dành cho những ai yêu thích sự thanh lịch và lãng mạn.'
                    }
                };
                return mockData[id];
            }

            // --- HÀM MOCKUP: Đổ dữ liệu vào form ---
            function fillForm(data) {
                $('#sp_id').val(data.id);
                $('#sp_ten').val(data.ten);
                $('#sp_mota').val(data.mota);
                $('#sp_gia').val(data.gia);
                $('#sp_tonkho').val(data.tonkho);
                $('#sp_danhmuc').val(data.danhmuc);
                $('#sp_trangthai').prop('checked', data.trangthai);
                $('#sp_thoigiantao').val(data.thoigiantao);
            }

            // --- HÀM: Xóa sạch form ---
            function clearForm() {
                $('#productForm')[0].reset();
                $('#sp_id').val('');
                $('#sp_trangthai').prop('checked', true);
            }

            // --- HÀM: Khóa hoặc Mở khóa form ---
            function toggleFormLock(disabled) {
                $('#productFieldset').prop('disabled', disabled);
                // Ẩn/hiện nút Lưu
                if (disabled) {
                    $('#saveProductBtn').hide();
                } else {
                    $('#saveProductBtn').show();
                }
            }

            // === XỬ LÝ SỰ KIỆN ===

            // 1. Bấm nút "Thêm sản phẩm mới"
            $('#addProduct').on('click', function () {
                clearForm();
                toggleFormLock(false); // Mở khóa form
                $('#productModalLabel').text('Thêm sản phẩm mới');
                $('#productModal').modal('show');
            });

            // 2. Bấm nút "Details"
            $('#productTableBody').on('click', '.btn-details', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                fillForm(data);
                toggleFormLock(true); // Khóa form
                $('#productModalLabel').text('Chi tiết sản phẩm');
                $('#productModal').modal('show');
            });

            // 3. Bấm nút "Edit"
            $('#productTableBody').on('click', '.btn-edit', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                fillForm(data);
                toggleFormLock(false); // Mở khóa form
                $('#productModalLabel').text('Chỉnh sửa sản phẩm');
                $('#productModal').modal('show');
            });

            // 4. Bấm nút "Remove"
            $('#productTableBody').on('click', '.btn-remove', function (e) {
                e.preventDefault();
                const id = $(this).data('id');
                const data = getMockProductData(id);

                // Đặt tên vào modal xác nhận
                $('#productNameRemove').text(data.ten + ` (ID: ${data.id})`);
                // Lưu id vào modal để dùng lúc bấm nút Xóa
                $('#removeProductId').val(id);

                $('#confirmRemoveModal').modal('show');
            });

            // 5. Bấm nút "Xóa" trên Modal xác nhận
            $('#confirmRemoveBtn').on('click', function () {
                const id = $('#removeProductId').val();

                // (Trong dự án thật, bạn sẽ dùng AJAX gọi về Controller để xóa)

                // Xóa (giả) hàng khỏi bảng
                $('#row-' + id).remove();

                // Đóng modal
                $('#confirmRemoveModal').modal('hide');
            });

        });
    </script>
}

