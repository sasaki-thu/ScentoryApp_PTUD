@model ScentoryApp.Models.ShopViewModel

@{
    ViewData["Title"] = "Cửa Hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="page-header py-5" style="background-color: #FFF7F1;">
    <div class="container text-center">
        <h1 class="section-title text-uppercase">Cửa Hàng</h1>
        <p class="text-secondary w-100 mx-auto">
            Khám phá bộ sưu tập mùi hương tinh tế của Scentory !
        </p>
    </div>
</section>

<div class="container py-5">
    <div class="row">
        <!-- SIDEBAR BÊN TRÁI -->
        <div class="col-lg-3 col-md-4">
            <div class="shop-sidebar">

                <!-- 1. Lọc theo giá (Dạng thanh trượt) -->
                <div class="filter-group">
                    <h5 class="filter-title">Khoảng giá</h5>
                    <input type="range" class="form-range" min="0" max="5000000" step="100000" id="priceRange" oninput="updatePriceLabel(this.value)">
                    <div class="d-flex justify-content-between mt-2">
                        <span class="small text-muted">159.000đ</span>
                        <span class="small text-muted" id="currentMaxPrice">719.000đ</span>
                    </div>
                </div>

                <hr />

                <div class="filter-group">
                    <h5 class="filter-title">Danh mục sản phẩm</h5>
                    <ul class="category-list">
                        <li><a href="#">Box quà <span class="category-count">(1)</span></a></li>
                        <li><a href="#">Hàng mới về <span class="category-count">(6)</span></a></li>
                        <li><a href="#">Nước hoa <span class="category-count">(8)</span></a></li>
                        <li><a href="#">Tinh dầu <span class="category-count">(4)</span></a></li>
                    </ul>
                </div>

                <hr />

                <!-- 3. Lọc theo dung tích -->
                <div class="filter-group">
                    <h5 class="filter-title">Dung tích</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="vol1">
                        <label class="form-check-label" for="vol1">10ml</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="vol2">
                        <label class="form-check-label" for="vol2">50ml</label>
                    </div>
                </div>

            </div>
        </div>

        <!-- NỘI DUNG SẢN PHẨM BÊN PHẢI -->
        <div class="col-lg-9 col-md-8">
            <!-- Thanh sắp xếp -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span>Hiển thị tất cả sản phẩm</span>
                <select class="form-select w-auto">
                    <option>Sắp xếp mặc định</option>
                    <option>Sắp xếp theo giá: thấp đến cao</option>
                    <option>Sắp xếp theo giá: cao đến thấp</option>
                </select>
            </div>

            <!-- Lưới sản phẩm -->
            <div class="row">
                @if (Model.Products != null && Model.Products.Any())
                {
                    foreach (var item in Model.Products)
                    {
                        <div class="col-lg-3 col-md-6 col-6 mb-5">
                            <div class="product-card">
                                <a href="@Url.Action("ProductDetails", "Home", new { id = item.IdSanPham })" class="product-link">
                                    <div class="product-img-wrap">
                                        @{
                                            string imgSrc;
                                            if (item.AnhSanPham != null && item.AnhSanPham.Length > 0)
                                            {
                                                var base64 = Convert.ToBase64String(item.AnhSanPham);
                                                imgSrc = $"data:image/jpeg;base64,{base64}";
                                            }
                                            else
                                            {
                                                // Ảnh default nếu chưa lưu binary trong DB
                                                imgSrc = Url.Content("~/assets/images/placeholder-product.png");
                                            }
                                        }
                                        <img src="@imgSrc"
                                             alt="@item.TenSanPham"
                                             class="img-fluid mb-3">
                                    </div>
                                </a>

                                <div class="price-wrap">
                                    @{
                                        // Ở đây tạm coi GiaNiemYet là giá bán hiện tại
                                        var salePrice = item.GiaNiemYet;
                                        // Nếu sau này bạn có thêm cột giá gốc thì thay logic ở đây
                                        var originalPrice = salePrice * 1.1m; // demo
                                    }
                                    <span class="sale-price">@salePrice.ToString("N0") ₫</span>
                                    <span class="original-price">@originalPrice.ToString("N0") ₫</span>
                                </div>

                                <div class="product-info">
                                    <p class="product-title">
                                        @item.TenSanPham
                                    </p>

                                    <button class="btn btn-add-cart">
                                        <i class="fa fa-shopping-cart"></i> Thêm vào giỏ hàng
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>Không có sản phẩm nào.</p>
                }
            </div>

            <!-- Phân trang -->
            @if (Model.TotalPages > 1)
            {
                <nav aria-label="Page navigation" class="mt-3">
                    <ul class="pagination justify-content-center">

                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link"
                               href="@Url.Action("Shop", "Home", new { page = Model.CurrentPage - 1 })"
                               tabindex="-1">←</a>
                        </li>

                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link"
                                   href="@Url.Action("Shop", "Home", new { page = i })">@i</a>
                            </li>
                        }

                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            <a class="page-link"
                               href="@Url.Action("Shop", "Home", new { page = Model.CurrentPage + 1 })">→</a>
                        </li>
                    </ul>
                </nav>
            }

        </div>
    </div>
</div>

<style>
    .product-card {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .product-info {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }

    .product-title {
        min-height: 3em;
        margin-bottom: 10px;
        font-weight: normal;
        font-size: 1em;
        color: #000;
        text-align: center;
    }

    .price-wrap {
        margin-bottom: auto;
        padding-bottom: 10px;
        text-align: center;
    }

    .sale-price {
        color: #dc3545;
        font-weight: bold;
        font-size: 1.1em;
        margin-right: 8px;
    }

    .original-price {
        text-decoration: line-through;
        color: #999;
        font-size: 0.9em;
    }

    .btn-add-cart {
        background-color: #c3a374;
        color: white;
        border: none;
        padding: 10px 15px;
        width: 100%;
        text-align: center;
        border-radius: 4px;
        transition: background-color 0.3s ease;
        margin-top: auto;
    }

        .btn-add-cart:hover {
            background-color: #a66b42;
            color: white;
        }

        .btn-add-cart i {
            margin-right: 5px;
        }

    .filter-group .form-check {
        padding-left: 0;
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }

    .filter-group .form-check-input {
        margin-left: 0;
        margin-right: 5px;
        position: relative;
        flex-shrink: 0;
    }

    .filter-group .form-check-label {
        margin: 4px !important;
        padding: 0 !important;
        cursor: pointer;
    }

    .filter-group .form-check-input:checked {
        background-color: #c38154;
        border-color: #c38154;
    }

    .filter-group .form-check-input:focus {
        border-color: #c38154;
        box-shadow: 0 0 0 0.25rem rgba(195, 129, 84, 0.25);
    }

    .form-range::-webkit-slider-thumb {
        background: #C38154;
    }

    .form-range::-moz-range-thumb {
        background: #C38154;
    }

    .form-range::-ms-thumb {
        background: #C38154;
    }

    .form-range::-webkit-slider-thumb:hover {
        background: #a66b42;
        transform: scale(1.2);
        box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }

    .form-range::-moz-range-thumb:hover {
        background: #a66b42;
        transform: scale(1.2);
        box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }

    .form-range:active::-webkit-slider-thumb {
        background: #8b5a35;
        transform: scale(1.3);
        box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    .form-range:active::-moz-range-thumb {
        background: #8b5a35;
        transform: scale(1.3);
        box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    .form-range:focus::-webkit-slider-thumb {
        border-color: #C38154;
        box-shadow: 0 0 0 0.25rem rgba(195, 129, 84, 0.25);
    }

    .form-range:focus::-moz-range-thumb {
        border-color: #C38154;
        outline: none;
    }

    .pagination {
        gap: 10px;
    }

        .pagination .page-item {
            margin: 0;
        }

        .pagination .page-link {
            color: #C38154;
            background-color: #fff;
            border: 2px solid #C38154;
            padding: 9px 16px;
            font-weight: 500;
            border-radius: 0;
            transition: all 0.3s ease;
            min-width: 50px;
            text-align: center;
        }

            .pagination .page-link:hover {
                color: #fff;
                background-color: #C38154;
                border-color: #C38154;
            }

        .pagination .page-item.active .page-link {
            background-color: #C38154;
            border-color: #C38154;
            color: #fff;
            font-weight: bold;
        }

        .pagination .page-item:first-child .page-link,
        .pagination .page-item:last-child .page-link {
            background-color: #fff;
            color: #C38154;
            border: 2px solid #C38154;
        }

            .pagination .page-item:first-child .page-link:hover,
            .pagination .page-item:last-child .page-link:hover {
                background-color: #C38154;
                color: #fff;
            }

        .pagination .page-item.disabled .page-link {
            color: #999;
            background-color: #f5f5f5;
            border-color: #ddd;
            cursor: not-allowed;
        }

        .pagination .page-link {
            border-radius: 0 !important;
        }
</style>
