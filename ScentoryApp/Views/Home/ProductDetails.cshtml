@model ScentoryApp.Models.SanPham

@{
    ViewData["Title"] = "Chi tiết sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string mainImgSrc;
    if (Model.AnhSanPham != null && Model.AnhSanPham.Length > 0)
    {
        var base64 = Convert.ToBase64String(Model.AnhSanPham);
        mainImgSrc = $"data:image/jpeg;base64,{base64}";
    }
    else
    {
        mainImgSrc = Url.Content("~/assets/images/placeholder-product.png");
    }
}

<section class="product-detail py-5">
    <div class="container">
        <div class="row">
            <!-- Cột trái - Hình ảnh sản phẩm -->
            <div class="col-lg-6 col-md-6">
                <div class="product-images">
                    <!-- Hình ảnh chính -->
                    <div class="main-image mb-3">
                        <img src="@mainImgSrc" alt="@Model.TenSanPham" class="img-fluid" id="mainImage">
                        <button class="zoom-btn">
                            <i class="fa fa-search-plus"></i>
                        </button>
                    </div>

                </div>
            </div>

            <!-- Cột phải - Thông tin sản phẩm -->
            <div class="col-lg-6 col-md-6">
                <div class="product-info-detail">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">
                                <a href="@Url.Action("Index", "Home")">Trang chủ</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="@Url.Action("Shop", "Home")">
                                    @(Model.IdDanhMucSanPhamNavigation?.TenDanhMucSanPham ?? "Danh mục")
                                </a>
                            </li>
                            <li class="breadcrumb-item active">@Model.TenSanPham</li>
                        </ol>
                    </nav>

                    <!-- Danh mục -->
                    <p class="product-category">
                        <a href="@Url.Action("Shop", "Home")">
                            @(Model.IdDanhMucSanPhamNavigation?.TenDanhMucSanPham ?? "Danh mục")
                        </a>
                    </p>

                    <!-- Tên sản phẩm -->
                    <h1 class="product-name mb-3">@Model.TenSanPham</h1>

                    <!-- Giá -->
                    <div class="product-price mb-4">
                        <span class="current-price">@Model.GiaNiemYet.ToString("N0") ₫</span>
                        @{
                            var oldPrice = Model.GiaNiemYet * 1.1m; // Demo, sau này thay bằng giá gốc thực tế
                        }
                        <span class="old-price">@oldPrice.ToString("N0") ₫</span>
                    </div>

                    <!-- Mô tả ngắn -->
                    <div class="product-short-desc mb-4">
                        <p>@Model.MoTaSanPham</p>
                    </div>


                    <!-- Số lượng và nút thêm giỏ hàng -->
                    <div class="product-actions mb-4">
                        <div class="quantity-selector">
                            <button class="qty-btn minus" onclick="decreaseQty()">-</button>
                            <input type="number" class="qty-input" value="1" min="1" id="quantity">
                            <button class="qty-btn plus" onclick="increaseQty()">+</button>
                        </div>
                        <button class="btn btn-add-to-cart"
                                onclick="addToCart('@Model.IdSanPham')">
                            THÊM VÀO GIỎ HÀNG
                        </button>
                    </div>

                    <!-- Thông tin thêm -->
                    <div class="product-meta">
                        <p><strong>SKU:</strong> @Model.IdSanPham</p>
                        <p>
                            <strong>Danh mục:</strong>
                            <a href="@Url.Action("Shop", "Home")">
                                @(Model.IdDanhMucSanPhamNavigation?.TenDanhMucSanPham ?? "Danh mục")
                            </a>
                        </p>
                        <p>
                            <strong>Thẻ:</strong>
                            <a href="#">@(Model.IdDanhMucSanPhamNavigation?.TenDanhMucSanPham ?? "tag")</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function changeMainImage(thumbnail) {
        document.getElementById('mainImage').src = thumbnail.src;

        document.querySelectorAll('.thumbnail-img').forEach(img => {
            img.classList.remove('active');
        });

        thumbnail.classList.add('active');
    }

    function increaseQty() {
        let qtyInput = document.getElementById('quantity');
        qtyInput.value = parseInt(qtyInput.value) + 1;
    }

    function decreaseQty() {
        let qtyInput = document.getElementById('quantity');
        if (parseInt(qtyInput.value) > 1) {
            qtyInput.value = parseInt(qtyInput.value) - 1;
        }
    }

     function addToCart(productId) {
        const quantity = parseInt(document.getElementById("quantity").value);

        fetch("/Cart/AddToCart", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                productId: productId,
                quantity: quantity
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                showToast("Đã thêm sản phẩm vào giỏ hàng", "success");

                document.getElementById("quantity").value = 1;

                if (typeof loadMiniCart === "function") {
                    loadMiniCart();
                }
            } else {
                showToast(data.message || "Không thể thêm sản phẩm", "error");
            }
        });
    }
</script>

<section class="product-tabs-section py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs product-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                            Mô tả
                        </button>
                    </li>
                </ul>

                <div class="tab-content product-tab-content">
                    <div class="tab-pane fade show active" id="description" role="tabpanel">
                        <div class="tab-inner-content">
                            <h5 class="mb-3">Thông tin chung:</h5>
                            <ul class="product-info-list">
                                <li>Thương hiệu: Scentory</li>
                                <li>Dung tích: 50ml (ví dụ)</li>
                            </ul>
                            <p class="mt-4">
                                @Model.MoTaSanPham
                            </p>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="additional" role="tabpanel">
                        <div class="tab-inner-content">
                            <p>Thông tin bổ sung sẽ được cập nhật...</p>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="reviews" role="tabpanel">
                        <div class="tab-inner-content">
                            <p>Chưa có đánh giá nào.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* Custom Chi tiết sản phẩm */
    .product-detail {
        background-color: #fff;
    }

    /* Hình ảnh sản phẩm */
    .product-images {
        position: sticky;
        top: 20px;
    }

    .main-image {
        position: relative;
        background-color: #f8f8f8;
        padding: 20px;
        border: 1px solid #e5e5e5;
    }

        .main-image img {
            width: 100%;
            height: auto;
        }

    .zoom-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }

        .zoom-btn:hover {
            background: #C38154;
            color: white;
        }

    /* Thumbnail */
    .thumbnail-gallery {
        margin-top: 15px;
    }

    .thumbnail-img {
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 5px;
        background: #f8f8f8;
    }

        .thumbnail-img:hover,
        .thumbnail-img.active {
            border-color: #C38154;
        }

    /* Breadcrumb */
    .breadcrumb {
        background: none;
        padding: 0;
        margin-bottom: 15px;
        font-size: 14px;
    }

    .breadcrumb-item a {
        color: #666;
        text-decoration: none;
    }

        .breadcrumb-item a:hover {
            color: #C38154;
        }

    .breadcrumb-item.active {
        color: #999;
    }

    /* Danh mục sản phẩm */
    .product-category {
        color: #C38154;
        font-size: 14px;
        text-transform: uppercase;
        margin-bottom: 10px;
    }

        .product-category a {
            color: #C38154;
            text-decoration: none;
        }

    /* Tên sản phẩm */
    .product-name {
        font-size: 28px;
        font-weight: 600;
        color: #333;
        line-height: 1.4;
    }

    /* Giá sản phẩm */
    .product-price {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .current-price {
        font-size: 32px;
        font-weight: bold;
        color: #dc3545;
    }

    .old-price {
        font-size: 20px;
        color: #999;
        text-decoration: line-through;
    }

    /* Mô tả sản phẩm */
    .product-short-desc {
        color: #666;
        line-height: 1.8;
        font-size: 15px;
    }

    /* Tùy chọn sản phẩm */
    .product-options {
        margin-bottom: 25px;
    }

    .option-label {
        display: block;
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
    }

    .product-options .form-select {
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 15px;
    }

        .product-options .form-select:focus {
            border-color: #C38154;
            box-shadow: 0 0 0 0.2rem rgba(195, 129, 84, 0.25);
        }

    /* Số lượng và Thêm vào giỏ hàng */
    .product-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .quantity-selector {
        display: flex;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
    }

    .qty-btn {
        background: #f8f8f8;
        border: none;
        width: 45px;
        height: 50px;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s ease;
        color: #666;
    }

        .qty-btn:hover {
            background: #C38154;
            color: white;
        }

    .qty-input {
        width: 70px;
        height: 50px;
        border: none;
        text-align: center;
        font-size: 16px;
        font-weight: 600;
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
    }

        .qty-input:focus {
            outline: none;
        }

        /* Remove arrow buttons from number input */
        .qty-input::-webkit-outer-spin-button,
        .qty-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

    .btn-add-to-cart {
        flex: 1;
        background-color: #C38154;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 15px;
        font-weight: 600;
        letter-spacing: 0.5px;
        border-radius: 4px;
        transition: all 0.3s ease;
        text-transform: uppercase;
    }

        .btn-add-to-cart:hover {
            background-color: #a66b42;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(195, 129, 84, 0.3);
        }

    /* Yêu thích */
    .wishlist-link a {
        color: #C38154;
        text-decoration: none;
        font-size: 15px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

        .wishlist-link a:hover {
            color: #a66b42;
        }

    .wishlist-link i {
        font-size: 18px;
    }

    /* Product meta */
    .product-meta {
        padding-top: 20px;
        border-top: 1px solid #e5e5e5;
        font-size: 14px;
        color: #666;
    }

        .product-meta p {
            margin-bottom: 8px;
        }

        .product-meta a {
            color: #C38154;
            text-decoration: none;
        }

            .product-meta a:hover {
                text-decoration: underline;
            }

    /* Product Tabs Section */
    .product-tabs-section {
        background-color: #fff;
        border-top: 1px solid #e5e5e5;
    }

    /* Điều hướng */
    .product-tabs {
        border-bottom: 2px solid #e5e5e5;
        gap: 0;
    }

        .product-tabs .nav-item {
            margin-bottom: 0;
        }

        .product-tabs .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            background: none;
            color: #666;
            font-size: 16px;
            font-weight: 500;
            padding: 15px 30px;
            transition: all 0.3s ease;
            border-radius: 0;
        }

            .product-tabs .nav-link:hover {
                color: #C38154;
                border-bottom-color: #C38154;
            }

            .product-tabs .nav-link.active {
                color: #C38154;
                border-bottom-color: #C38154;
                background: none;
            }

    /* Tab Content */
    .product-tab-content {
        padding: 40px 0;
    }

    .tab-inner-content {
        max-width: 1400px;
    }

        .tab-inner-content h5 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .tab-inner-content h6 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

    .highlight-icon {
        font-size: 20px;
    }

    /* Product Info List */
    .product-info-list {
        list-style: none;
        padding-left: 0;
        margin-bottom: 0;
    }

        .product-info-list li {
            padding: 8px 0;
            color: #666;
            font-size: 15px;
            line-height: 1.6;
        }

            .product-info-list li:before {
                content: "•";
                color: #C38154;
                font-weight: bold;
                display: inline-block;
                width: 20px;
                margin-left: 0;
            }

    /* Feature List */
    .feature-list {
        list-style: none;
        padding-left: 0;
    }

        .feature-list li {
            padding: 8px 0;
            color: #666;
            font-size: 15px;
            line-height: 1.6;
            position: relative;
            padding-left: 25px;
        }

            .feature-list li:before {
                content: "•";
                color: #C38154;
                font-weight: bold;
                position: absolute;
                left: 0;
                top: 8px;
            }

    /* Text Styling */
    .tab-inner-content p {
        color: #666;
        font-size: 15px;
        line-height: 1.8;
        margin-bottom: 15px;
    }

    .tab-inner-content strong {
        color: #333;
        font-weight: 600;
    }

    .note-text {
        font-style: italic;
        color: #777;
    }

    /* Có thể bạn thích */
    .related-products-section {
        background-color: #fff;
        border-top: 1px solid #e5e5e5;
    }

    .section-title {
        font-size: 28px;
        font-weight: 600;
        color: #333;
    }

    /* Product Card */
    .product-card-related {
        position: relative;
        background: #fff;
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

        .product-card-related:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

    /* Product Badge */
    .product-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #dc3545;
        color: white;
        padding: 5px 12px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 3px;
        z-index: 2;
    }

    /* Product Status Badge (Hết hàng) */
    .product-status-badge {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #C38154;
        color: white;
        padding: 8px 20px;
        font-size: 15px;
        font-weight: bold;
        border-radius: 3px;
        z-index: 3;
        text-transform: uppercase;
    }

    /* Ảnh sản phẩm */
    .product-img-wrap {
        position: relative;
        padding: 10px;
        background: #f8f8f8;
        margin-bottom: 15px;
    }

        .product-img-wrap img {
            width: 100%;
            height: auto;
            transition: transform 0.3s ease;
        }

    .product-card-related:hover .product-img-wrap img {
        transform: scale(1.05);
    }

    /* Thông tin sản phẩm */
    .product-info-related {
        padding: 0 15px 20px;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }

    .price-wrap-related {
        text-align: center;
        margin-bottom: 10px;
    }

    .sale-price-related {
        color: #dc3545;
        font-size: 20px;
        font-weight: bold;
        margin-right: 8px;
    }

    .original-price-related {
        color: #999;
        font-size: 16px;
        text-decoration: line-through;
    }

    .product-title-related {
        font-size: 15px;
        color: #333;
        font-weight: normal;
        text-align: center;
        margin-bottom: 15px;
        min-height: 48px;
        line-height: 1.5;
    }

    /* Nút ATC */
    .btn-add-cart-related,
    .btn-read-more-related {
        width: 100%;
        padding: 12px 15px;
        border: none;
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 3px;
        transition: all 0.3s ease;
        margin-top: auto;
    }

    .btn-add-cart-related {
        background-color: #C38154;
        color: white;
    }

        .btn-add-cart-related:hover {
            background-color: #a66b42;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(195, 129, 84, 0.3);
        }

    .btn-read-more-related {
        background-color: #C38154;
        color: white;
    }

        .btn-read-more-related:hover {
            background-color: #a66b42;
        }

</style>